# üéØ –û–¢–ß–ï–¢ –û –†–ï–ó–£–õ–¨–¢–ê–¢–ê–• –°–ò–ú–£–õ–Ø–¶–ò–ò CAPSIM

## üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–î–∞—Ç–∞ –∑–∞–ø—É—Å–∫–∞:** 6 –∏—é–ª—è 2025  
**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 6 —á–∞—Å–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–∏  
**–†–µ–∂–∏–º:** Realtime —Å —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º x120  
**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≥–µ–Ω—Ç–æ–≤:** 300 (—Å–æ–∑–¥–∞–Ω–æ 582 –≥–ª–æ–±–∞–ª—å–Ω–æ)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

---

## üìä –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### üë• –ê–≥–µ–Ω—Ç—ã
- **–í—Å–µ–≥–æ –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ:** 582
- **–ê–∫—Ç–∏–≤–Ω—ã—Ö –≤ —Å–∏–º—É–ª—è—Ü–∏–∏:** 283
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏—è–º:**
  - ShopClerk: 108 (18.6%) - —Å–∞–º–∞—è –ø–æ–ø—É–ª—è—Ä–Ω–∞—è
  - Teacher: 84 (14.4%)
  - Worker: 66 (11.3%)
  - Developer: 60 (10.3%)
  - Businessman: 57 (9.8%)

### üìà –°–æ–±—ã—Ç–∏—è
- **–í—Å–µ–≥–æ —Å–æ–±—ã—Ç–∏–π:** 2,621
- **–¢–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:**
  - –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤: 784 (29.9%)
  - –ü–æ–∫—É–ø–∫–∏: 628 (24.0%)
  - –°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ: 532 (20.3%)
  - –î–µ–π—Å—Ç–≤–∏—è –∞–≥–µ–Ω—Ç–æ–≤: 258 (9.8%)
  - –í–ª–∏—è–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤: 184 (7.0%)

### üî• –¢—Ä–µ–Ω–¥—ã
- **–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–¥–æ–≤:** 7
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ–º:** 100% (–≤—Å–µ 7 –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
- **–°–∞–º—ã–µ –≤–∏—Ä—É—Å–Ω—ã–µ —Ç–µ–º—ã:**
  - Culture: 0.790 –≤–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å
  - Sport: 0.702 –≤–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å
  - Conspiracy: 0.634 –≤–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å

---

## üîÑ Realtime —Ä–µ–∂–∏–º

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
1. **Clock abstraction** - —Ä–∞–±–æ—Ç–∞—é—Ç `SimClock` –∏ `RealTimeClock`
2. **Async engine** - —Å–æ–±—ã—Ç–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
3. **Time conversion** - sim_time ‚Üí real_time —Å —É—á–µ—Ç–æ–º `SIM_SPEED_FACTOR`
4. **Batch commits** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ –ë–î
5. **Metrics tracking** - –∏–∑–º–µ—Ä–µ–Ω–∏–µ latency —Å–æ–±—ã—Ç–∏–π

### üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏:** 120x —É—Å–∫–æ—Ä–µ–Ω–∏–µ
- **Latency —Å–æ–±—ã—Ç–∏–π:** < 10ms P95
- **Batch —Ä–∞–∑–º–µ—Ä:** 100 —Å–æ–±—ã—Ç–∏–π –∏–ª–∏ 60 —Å–µ–∫
- **–í—Ä–µ–º—è —Å–∏–º—É–ª—è—Ü–∏–∏:** 6 —á–∞—Å–æ–≤ ‚Üí 3 –º–∏–Ω—É—Ç—ã —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

---

## üéØ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ realtime ‚úÖ
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª `Clock` —Å `sleep_until()`
- Engine –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –≤ async —Ä–µ–∂–∏–º
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `timestamp_real` –≤ —Å–æ–±—ã—Ç–∏—è
- –ù–∞—Å—Ç—Ä–æ–µ–Ω `SIM_SPEED_FACTOR=120`

### 2. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å ‚úÖ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 300+ –∞–≥–µ–Ω—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ 2,600+ —Å–æ–±—ã—Ç–∏–π
- Batch-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î –æ–ø–µ—Ä–∞—Ü–∏–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Prometheus/Grafana

### 3. –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ ‚úÖ
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤ –ø–æ –≤—Å–µ–º —Ç–µ–º–∞–º
- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∞–≥–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –ø–æ—Å—Ç—ã
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫—É–ø–æ–∫ –∏ —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—è
- –í–ª–∏—è–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤ –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
-- –°—Ö–µ–º–∞: capsim
-- –¢–∞–±–ª–∏—Ü—ã: persons, events, trends, simulation_runs
-- –°–≤—è–∑–∏: foreign keys, parent_trend_id –¥–ª—è —Ü–µ–ø–æ—á–µ–∫
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **Grafana:** http://localhost:3000
- **Prometheus:** http://localhost:9091
- **PostgreSQL:** localhost:5432
- **API:** http://localhost:8000

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- JSON-—Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Loki
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏—è–º

| –ü—Ä–æ—Ñ–µ—Å—Å–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | –¢—Ä–µ–Ω–¥-—Ä–µ—Ü–µ–ø—Ç–∏–≤–Ω–æ—Å—Ç—å |
|-----------|------------|------------|-------------------|
| ShopClerk | 108 | –í—ã—Å–æ–∫–∞—è | 0.5-1.5 |
| Teacher | 84 | –°—Ä–µ–¥–Ω—è—è | 0.5-1.5 |
| Developer | 60 | –í—ã—Å–æ–∫–∞—è | 1.5-2.5 |
| Businessman | 57 | –°—Ä–µ–¥–Ω—è—è | 1.0-2.0 |
| Blogger | 45 | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | 2.0-3.0 |

---

## üîó –¶–µ–ø–æ—á–∫–∏ —Ç—Ä–µ–Ω–¥–æ–≤

**–°—Ç–∞—Ç—É—Å:** üîÑ –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- –ú–µ—Ö–∞–Ω–∏–∑–º `parent_trend_id` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- –ü–æ–∫–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∞–∫—Ç–∏–≤–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏
- –¢—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ —Å–∏–º—É–ª—è—Ü–∏–∏

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å foreign key –æ—à–∏–±–∫–∏ —Å —Ç—Ä–µ–Ω–¥–∞–º–∏
2. –£–≤–µ–ª–∏—á–∏—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–º—É–ª—è—Ü–∏–∏ –¥–æ 24 —á–∞—Å–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∞–≥–µ–Ω—Ç–æ–≤ (1000+)

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å catch-up strategy –¥–ª—è realtime
2. –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —Ü–µ–ø–æ—á–µ–∫ —Ç—Ä–µ–Ω–¥–æ–≤
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è 10k –∞–≥–µ–Ω—Ç–æ–≤

---

## üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã
1. **Events Realtime** - —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
2. **Performance Tuning** - –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **PostgreSQL Stats** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î
4. **Logs Dashboard** - –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞
```bash
# –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
docker-compose up -d

# –ó–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ü–∏–∏
python run_simulation_6h_300_agents.py

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
python show_simulation_results.py
```

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏–º—É–ª—è—Ü–∏—è **—É—Å–ø–µ—à–Ω–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç**:

1. **–†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å realtime —Ä–µ–∂–∏–º–∞** - —Å–æ–±—ã—Ç–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å —É—á–µ—Ç–æ–º —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ—Ç–µ–Ω –∞–≥–µ–Ω—Ç–æ–≤ –∏ —Ç—ã—Å—è—á —Å–æ–±—ã—Ç–∏–π
3. **–°–æ—Ü–∏–∞–ª—å–Ω—É—é –¥–∏–Ω–∞–º–∏–∫—É** - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∞–≥–µ–Ω—Ç–æ–≤
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å** - –ø–æ–ª–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

**–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–∫–∞–∑—á–∏–∫—É!** üéâ 