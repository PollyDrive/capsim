# Интеграция проверки рабочих часов

## Обзор

Система проверки рабочих часов интегрирована в планировщик событий для обеспечения реалистичного поведения агентов. Агенты неактивны в ночное время (00:00-08:00) и активны в рабочие часы (08:00-23:59).

## Функциональность

### Основная функция
- `is_work_hours(simulation_minutes: float) -> bool` - проверяет, находится ли время в рабочих часах

### Рабочие часы
- **Активные часы**: 08:00-23:59 (агенты могут выполнять действия)
- **Неактивные часы**: 00:00-07:59 (агенты спят)

## Интегрированные функции планировщика

### Функции с проверкой рабочих часов
1. `_schedule_seed_actions()` - планирование первичных событий
2. `_schedule_uniform_agent_actions()` - равномерное планирование действий
3. `_schedule_agent_actions()` - планирование действий существующих агентов
4. `_schedule_actions_batch()` - пакетное планирование действий
5. `_schedule_random_wellness()` - планирование wellness действий

### Функции БЕЗ проверки рабочих часов
- `_schedule_system_events()` - системные события планируются независимо от времени

## Логирование

При пропуске событий в ночное время записывается лог с информацией:
```json
{
  "event": "agent_actions_skipped",
  "reason": "night_time",
  "current_time": 960.0,
  "human_time": "00:00",
  "message": "Агенты неактивны в ночное время (00:00-08:00)"
}
```

## Примеры использования

### Проверка времени
```python
from capsim.common.time_utils import is_work_hours

# Рабочие часы
is_work_hours(0)     # True  - 08:00
is_work_hours(900)   # True  - 23:00

# Нерабочие часы
is_work_hours(960)   # False - 00:00
is_work_hours(1380)  # False - 07:00
```

### Интеграция в планировщик
```python
from capsim.common.time_utils import is_work_hours, convert_sim_time_to_human

if not is_work_hours(self.current_time):
    human_time = convert_sim_time_to_human(self.current_time)
    logger.info(f"Агенты неактивны в {human_time}")
    return 0  # Пропускаем планирование
```

## Тестирование

Созданы комплексные тесты в `tests/unit/test_work_hours_integration.py`:
- Тесты проверки рабочих часов
- Тесты интеграции с планировщиком
- Тесты логирования пропущенных событий
- Тесты граничных случаев

## Влияние на симуляцию

### Положительные эффекты
- Более реалистичное поведение агентов
- Естественные циклы активности/покоя
- Концентрация событий в рабочие часы

### Системные события
- Восстановление энергии (EnergyRecoveryEvent)
- Ночные циклы (NightCycleEvent)  
- Утреннее восстановление (MorningRecoveryEvent)
- Ежедневный сброс (DailyResetEvent)

Все системные события планируются независимо от времени суток для обеспечения корректной работы симуляции.